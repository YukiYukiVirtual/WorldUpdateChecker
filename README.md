# WorldUpdateChecker

ワールドインスタンスにいる人に対して、ワールドの更新を通知します。
これによって、インスタンスの解散を促し、インスタンス内での処理の不整合を予防することが期待できます。

## 動作概要
- ワールドインスタンス作成時に、現在時刻を記憶します。
- 後からJoinしてきた人がいれば、上記の時刻とワールド更新時刻を比較します。
- ワールドが更新されて、ワールド更新時刻の方が進んだら、あなたが設定した`Target Udon Behaviour`の`Target Udon Method Name`が、全プレイヤーのクライアント上で動作します。
- VRChatのAPIを必要以上にコールしないようにしてあります。

## 使い方
1. Blueprint IDを取得するために、ワールドをアップロードしてください。
2. Blueprint IDをコピーしてください。(ワールド作者なら分かりますよね？)
3. `WorldUpdateChecker.prefab`をワールドに設置してください。常にActiveであればどこでもいいです。
4. バージョンチェックに引っかかった時に動作するUdonを作成してください。`public void 任意のMethod名()`としてください。
5. `WorldUpdateChecker`のInspectorを開き、以下を設定してください。
 - Url：既に書かれているURL(`https://api.vrchat.cloud/api/1/worlds/`)の後ろに、②のIDをペーストしてください。
 - Target Udon Behaviour：バージョンチェックに引っかかった時に動かしたいUdonを設定してください。
 - Target Udon Method Name：上記Udonの動かしたいメソッド名を設定してください。

以上

## サンプルシーン
sampleフォルダに`sample.scene`があります。動作について簡単に確認できます。  
中には`WorldUpdateChecker`というGameObjectがあります。Urlに設定されているのは、実際のワールドのURLです。  
このサンプルでは`VersionUnmatchMarker`というUdonSharpBehaviourの`Show`というメソッドをコールし、看板を出すようにしています。  
どういう風に通知するのかはあなたが決めてください！

## 注意事項
- 設定項目に間違いがあると、もちろん正しく動きません。Unity上で実行するとエラーログが出るようになっているので確認してください。
- VRChatの設定で、信頼されていないURLを許可する必要があります。  
インスタンス内に一人でも許可している人がいれば動く作りになっていますが、全員許可していなければ諦めてください。後から来た人が許可していれば動きます。  
許可していない人が後から許可する可能性は低いため、そういう人はいないものとして作ってあります。

## ライセンス
MITライセンスです。ワールドに使用する際は、クレジット表記（名前とシステム名のみの省略表記で可）をお願いします。
